+++
title = "Nginx配置项sendfile：零拷贝"
tags = [
"nginx",
"Chinese",
]
date = "2022-08-01 21:28:39"
categories = [
"Chinese",
]
+++




#  Nginx配置项sendfile：零拷贝

    
    
    



Nginx 中的 sendfile 配置项用来在两个文件描述符之间直接传递数据(完全在内核中操作)，从而避免了数据在内核缓冲区和用户缓冲区之间的拷贝，操作效率很高，被称之为零拷贝，如下表所示：




  

名称 |  零复制指令  
---|---  
指令 |  sendfile  
作用域 |  http、server、location  
默认值 |  off  
指令值选项 |  on 或 off  
指令说明 |  启用零复制（sendfile）。零复制（也称零拷贝）是读取本地文件后向网络接口发送文件内容的文件传输机制  
  
配置样例如下：  

http {  
sendfile on;  
}

默认配置下，Nginx 读取本地文件后，在进行网络传输时会先将硬盘文件从硬盘中读取到 Nginx 的文件缓冲区中，操作流程为硬盘 -> 内核文件缓冲区 ->
应用缓冲区。然后将 Nginx 文件缓冲区的数据写入网络接口，操作流程：应用缓冲区 -> 内核网络缓冲区 -> 网络接口。  
  
Nginx
的本地文件在进行网络传输的过程中，经历了上述两个操作过程，两次操作都在内核缓冲区中存储了相同的数据。为了提高文件的传输效率，内核提供了零复制技术，该技术支持文件在内核缓冲区内直接交换打开的文件句柄，无须重复复制文件内容到缓冲区，则上述两个操作的流程变为：硬盘
-> 内核文件缓冲区 -> 内核网络缓冲区 -> 网络接口。  
  



